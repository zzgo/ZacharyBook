分布式锁和事务实战

引言

为什么要使用锁？

单机里面，可以完美的解决锁和事务

锁的场景

> 多任务环境下，多对一的资源访问
>
> 有状态的资源，会出现不一样的结果（有状态类）

问题本质

> 状态的变迁，需要时间，存在中间态
>
> 在1+1+1=3还未得出结果前，状态还是1，但只是幻象
>
> 其他任务出幻象值1，是错误的结果

锁的思路

> 对资源的访问进行排它处理
>
> 1+1+1=3得出结果之前，不允许别人染指
>
> 所有任务必须有序过独木桥

步骤

> 通过竞争获取锁（①竞争锁-排队）
>
> 任务在对资源操作中（②占有锁-占坑）
>
> 其他任务等待（③任务阻塞）
>
> 直到该任务完成（④释放锁）

目的

> 多个外部线程同时来竞争使用统一资源时，会彼此影响，导致混乱
>
> 将资源的使用做排它性处理，使同一时间，仅一个线程能访问资源



